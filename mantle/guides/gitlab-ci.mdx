---
title: GitLab CI
description: 'Protect your GitLab CI/CD pipelines'
---

# GitLab CI Integration

Mantle integrates seamlessly with GitLab CI/CD to protect your pipeline logs from secret exposure.

## Basic Setup

Add Mantle to your `.gitlab-ci.yml`:

```yaml
stages:
  - test

test:
  stage: test
  image: node:20
  before_script:
    - npm install -g @dotsetlabs/mantle
  script:
    - mantle run --mode redact -- npm test
  variables:
    DATABASE_URL: $DATABASE_URL
    API_KEY: $API_KEY
```

<Note>
GitLab CI variables are automatically available as environment variables. Mantle's `environment` provider detects them.
</Note>

## Using Protected Variables

GitLab's [protected and masked variables](https://docs.gitlab.com/ee/ci/variables/#protect-a-cicd-variable) are passed to your jobs as environment variables:

```yaml
deploy:
  stage: deploy
  before_script:
    - npm install -g @dotsetlabs/mantle
  script:
    - mantle run --mode redact -- ./deploy.sh
  variables:
    DEPLOY_TOKEN: $DEPLOY_TOKEN
    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID
    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
  only:
    - main
```

## Using with .env Files

Create a `.env` file from CI variables:

```yaml
test:
  before_script:
    - npm install -g @dotsetlabs/mantle
    - echo "DATABASE_URL=$DATABASE_URL" >> .env
    - echo "API_KEY=$API_KEY" >> .env
  script:
    - mantle run --mode redact -- npm test
```

## Caching Mantle Installation

Speed up your pipelines by caching the global npm packages:

```yaml
variables:
  npm_config_cache: "$CI_PROJECT_DIR/.npm"

cache:
  paths:
    - .npm/

test:
  before_script:
    - npm install -g @dotsetlabs/mantle
  script:
    - mantle run --mode redact -- npm test
```

## Complete Example

```yaml
stages:
  - test
  - deploy

variables:
  npm_config_cache: "$CI_PROJECT_DIR/.npm"

cache:
  paths:
    - .npm/
    - node_modules/

.mantle-setup: &mantle-setup
  before_script:
    - npm install -g @dotsetlabs/mantle

test:
  <<: *mantle-setup
  stage: test
  image: node:20
  script:
    - npm ci
    - mantle run --mode redact -- npm test
  variables:
    DATABASE_URL: $DATABASE_URL

deploy:
  <<: *mantle-setup
  stage: deploy
  image: node:20
  script:
    - mantle run --mode redact -- ./scripts/deploy.sh
  variables:
    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID
    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
  only:
    - main
```
