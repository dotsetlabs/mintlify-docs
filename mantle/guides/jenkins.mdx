---
title: Jenkins
description: 'Protect your Jenkins pipelines'
---

# Jenkins Integration

Mantle integrates with Jenkins to protect your build logs from secret exposure.

## Prerequisites

Ensure Node.js 18+ is available on your Jenkins agents:

```groovy
tools {
    nodejs 'NodeJS-20'
}
```

Or use a Docker agent with Node.js pre-installed.

## Basic Declarative Pipeline

```groovy
pipeline {
    agent any
    
    tools {
        nodejs 'NodeJS-20'
    }
    
    stages {
        stage('Setup') {
            steps {
                sh 'npm install -g @dotsetlabs/cli'
            }
        }
        
        stage('Test') {
            steps {
                sh 'dotset mantle run --mode redact -- npm test'
            }
        }
    }
}
```

## Using Jenkins Credentials

Mantle auto-detects environment variables from [Jenkins credentials](https://www.jenkins.io/doc/book/using/using-credentials/):

```groovy
pipeline {
    agent any
    
    environment {
        DATABASE_URL = credentials('database-url')
        API_KEY = credentials('api-key')
    }
    
    stages {
        stage('Setup') {
            steps {
                sh 'npm install -g @dotsetlabs/cli'
            }
        }
        
        stage('Test') {
            steps {
                sh 'dotset mantle run --mode redact -- npm test'
            }
        }
    }
}
```

<Note>
Store your secrets in Jenkins Credentials and reference them with `credentials()`. Mantle will detect them from the environment.
</Note>

## Using withCredentials Block

For more control, use the `withCredentials` block:

```groovy
pipeline {
    agent any
    
    stages {
        stage('Setup') {
            steps {
                sh 'npm install -g @dotsetlabs/cli'
            }
        }
        
        stage('Deploy') {
            steps {
                withCredentials([
                    string(credentialsId: 'aws-access-key', variable: 'AWS_ACCESS_KEY_ID'),
                    string(credentialsId: 'aws-secret-key', variable: 'AWS_SECRET_ACCESS_KEY')
                ]) {
                    sh 'dotset mantle run --mode redact -- ./deploy.sh'
                }
            }
        }
    }
}
```

## Using with .env Files

Create a `.env` file from credentials:

```groovy
stage('Test') {
    steps {
        withCredentials([
            string(credentialsId: 'database-url', variable: 'DATABASE_URL'),
            string(credentialsId: 'api-key', variable: 'API_KEY')
        ]) {
            sh '''
                echo "DATABASE_URL=$DATABASE_URL" > .env
                echo "API_KEY=$API_KEY" >> .env
                dotset mantle run --mode redact -- npm test
            '''
        }
    }
}
```

## Docker Agent

If using Docker agents:

```groovy
pipeline {
    agent {
        docker {
            image 'node:20'
        }
    }
    
    stages {
        stage('Setup') {
            steps {
                sh 'npm install -g @dotsetlabs/cli'
            }
        }

        stage('Test') {
            steps {
                sh 'dotset mantle run --mode redact -- npm test'
            }
        }
    }
}
```

## Scripted Pipeline

For scripted pipelines:

```groovy
node {
    stage('Checkout') {
        checkout scm
    }
    
    stage('Setup') {
        sh 'npm install -g @dotsetlabs/cli'
    }
    
    stage('Test') {
        withCredentials([
            string(credentialsId: 'database-url', variable: 'DATABASE_URL')
        ]) {
            sh 'dotset mantle run --mode redact -- npm test'
        }
    }
}
```

## Complete Example

```groovy
pipeline {
    agent any

    tools {
        nodejs 'NodeJS-20'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Install Dependencies') {
            steps {
                sh 'npm install -g @dotsetlabs/cli'
                sh 'npm ci'
            }
        }
        
        stage('Test') {
            environment {
                DATABASE_URL = credentials('database-url')
            }
            steps {
                sh 'dotset mantle run --mode redact -- npm test'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                withCredentials([
                    string(credentialsId: 'aws-access-key', variable: 'AWS_ACCESS_KEY_ID'),
                    string(credentialsId: 'aws-secret-key', variable: 'AWS_SECRET_ACCESS_KEY')
                ]) {
                    sh 'dotset mantle run --mode redact -- ./scripts/deploy.sh'
                }
            }
        }
    }
    
    post {
        always {
            cleanWs()
        }
    }
}
```
