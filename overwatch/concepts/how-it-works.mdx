---
title: "How Overwatch Works"
description: "Understanding Overwatch's command interception and validation"
---

# How Overwatch Works

Overwatch protects your terminal by intercepting commands before they execute, analyzing their risk, and either allowing them, blocking them, or asking for your approval.

## The Interception Pipeline

```
┌─────────────┐     ┌──────────────┐     ┌──────────────┐     ┌─────────────┐
│ You type a  │ --> │  Shell hook  │ --> │   Overwatch  │ --> │   Execute   │
│   command   │     │  intercepts  │     │   analyzes   │     │  or block   │
└─────────────┘     └──────────────┘     └──────────────┘     └─────────────┘
```

### 1. Shell Hook Integration

When you run `overwatch init`, Overwatch adds a hook to your shell configuration:

- **Bash**: Uses `bash-preexec` or DEBUG trap
- **Zsh**: Overrides the `accept-line` widget
- **Fish**: Binds to the Enter key

The hook intercepts commands before they're passed to the shell for execution.

### 2. Fast Path for Safe Commands

Common safe commands bypass analysis entirely for performance:

```bash
ls, cd, pwd, echo, cat, less, more, head, tail, grep, find
git status, git diff, git log, git branch, git show
```

### 3. Risk Analysis

For other commands, Overwatch analyzes the risk using pattern matching:

| Risk Level | Examples | Default Action |
|------------|----------|----------------|
| **safe** | `echo "hello"` | Allow |
| **read** | `cat file.txt` | Allow |
| **write** | `touch newfile` | Prompt |
| **destructive** | `rm -rf node_modules` | Prompt |
| **dangerous** | `rm -rf /`, `:(){ :\|:& };:` | Deny |

### 4. Policy Evaluation

Your configured policy determines what happens:

```yaml
overwatch:
  risks:
    safe: allow        # Auto-allow safe commands
    read: allow        # Auto-allow read operations
    write: prompt      # Ask before write operations
    destructive: prompt # Ask before destructive operations
    dangerous: deny    # Block dangerous commands
```

### 5. Session Grants

When you approve a command, you can choose a session duration:

- **Once** - Just this one time
- **5 minutes** - Auto-approve similar commands for 5 minutes
- **15 minutes** - Auto-approve for 15 minutes
- **Session** - Auto-approve until shell restart

## Context-Aware Analysis

Overwatch considers context when assessing risk:

### Project Context
- Is this a regenerable file (node_modules, .venv)?
- What type of project is this (Node.js, Python, Go)?

### Git Context
- Are there uncommitted changes that could be lost?
- Can changes be recovered from Git history?

### Environment Context
- Is this a production or development environment?
- Are there sensitive paths being accessed?

## Safer Alternatives

When you try to run a risky command, Overwatch suggests safer alternatives:

```
Command: rm -rf node_modules
Risk: destructive

Safer alternatives:
  1. rm -rf node_modules (can be regenerated with npm install)
  2. mv node_modules node_modules.bak
```

## Reversibility Analysis

Overwatch assesses whether a command can be undone:

- **Reversible** - Can be undone (e.g., `git checkout`)
- **Partially reversible** - Some effects can be undone
- **Irreversible** - Cannot be undone (e.g., `rm` without backup)

## Pattern Learning

Over time, Overwatch learns from your approval patterns and suggests policy rules to reduce future prompts.

## Audit Logging

All command checks are logged to an SQLite database:

```bash
overwatch log           # View recent entries
overwatch log --denied  # View only denied commands
```
