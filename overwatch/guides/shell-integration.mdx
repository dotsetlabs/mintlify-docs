---
title: "Shell Integration"
description: "Detailed guide for integrating Overwatch with your shell"
---

# Shell Integration

Overwatch integrates with your shell to intercept commands before they execute. This guide covers the details of shell integration for Bash, Zsh, and Fish.

## Supported Shells

| Shell | Integration Method | Status |
|-------|-------------------|--------|
| Bash | preexec / DEBUG trap | Full support |
| Zsh | accept-line widget | Full support |
| Fish | Key binding | Full support |

## Automatic Setup

The easiest way to set up shell integration:

```bash
overwatch init
```

This automatically:
1. Detects your shell
2. Adds the hook to your shell config
3. Provides restart instructions

## Manual Setup

### Bash

Add to `~/.bashrc`:

```bash
# Overwatch - AI Shell Guardian
eval "$(overwatch hook bash)"
```

**How it works:**

Overwatch uses `bash-preexec` if available, otherwise falls back to the DEBUG trap. The preexec method is preferred as it only triggers on actual command execution.

### Zsh

Add to `~/.zshrc`:

```bash
# Overwatch - AI Shell Guardian
eval "$(overwatch hook zsh)"
```

**How it works:**

Overwatch overrides the `accept-line` widget, which is called when you press Enter. This intercepts commands at the input level, before parsing.

### Fish

Add to `~/.config/fish/config.fish`:

```fish
# Overwatch - AI Shell Guardian
overwatch hook fish | source
```

**How it works:**

Fish doesn't support true preexec, so Overwatch binds to the Enter key to intercept commands.

## Hook Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                      YOUR TERMINAL                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │  Type    │ -> │ Shell Hook   │ -> │  Overwatch   │       │
│  │ Command  │    │ (intercept)  │    │   (check)    │       │
│  └──────────┘    └──────────────┘    └──────┬───────┘       │
│                                              │               │
│                          ┌───────────────────┼───────────┐   │
│                          │                   │           │   │
│                          ▼                   ▼           ▼   │
│                     ┌────────┐         ┌─────────┐  ┌──────┐ │
│                     │ Allow  │         │ Prompt  │  │ Deny │ │
│                     └───┬────┘         └────┬────┘  └──┬───┘ │
│                         │                   │          │     │
│                         ▼                   ▼          ▼     │
│                    ┌─────────┐        ┌──────────┐ ┌───────┐ │
│                    │ Execute │        │ User     │ │ Block │ │
│                    │ Command │        │ Decides  │ │       │ │
│                    └─────────┘        └──────────┘ └───────┘ │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## Fast Path Bypass

For performance, these commands bypass analysis:

```bash
# Navigation and display
ls, cd, pwd, echo, cat, less, more, head, tail

# Search and help
grep, find, which, type, man, help, history, alias

# Git read-only
git status, git diff, git log, git branch, git show
```

You can customize the fast path in configuration.

## Helper Functions

After installation, these helper functions are available:

```bash
# Temporarily disable Overwatch
overwatch-disable

# Re-enable Overwatch
overwatch-enable

# Check status
overwatch-status
```

## Environment Variables

| Variable | Purpose |
|----------|---------|
| `OVERWATCH_DISABLED` | Set to `1` to disable |
| `__OVERWATCH_INSTALLED` | Tracks installation status |
| `__OVERWATCH_RUNNING` | Prevents recursion |

## Troubleshooting

### Commands not being intercepted

1. Check if Overwatch is installed:
   ```bash
   overwatch-status
   ```

2. Verify the hook is in your config:
   ```bash
   grep -l "overwatch" ~/.bashrc ~/.zshrc 2>/dev/null
   ```

3. Restart your shell or source the config:
   ```bash
   source ~/.bashrc
   ```

### Performance issues

If you notice slowdown:

1. The fast path should handle common commands
2. Check if custom rules are too broad
3. Enable debug logging to identify bottlenecks

### Conflicts with other tools

Overwatch may conflict with other preexec tools. If you experience issues:

1. Load Overwatch last in your shell config
2. Check for duplicate hook installations
3. Use `overwatch-disable` to isolate issues

## Uninstalling

To remove shell integration:

1. Remove the Overwatch line from your shell config
2. Restart your shell
3. Optionally uninstall the package:
   ```bash
   npm uninstall -g @dotsetlabs/tollgate
   ```
