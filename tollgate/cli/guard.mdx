---
title: guard
description: 'Shell Guardian command for direct shell protection'
---

# tollgate guard

Shell Guardian provides direct shell command protection without MCP. It intercepts commands before execution and applies policy-based access control.

## Synopsis

```bash
tollgate guard <command> [options]
```

## Commands

| Command | Description |
|:--------|:------------|
| `init` | Generate shell integration hooks |
| `check` | Evaluate a command (used by shell hooks) |
| `preview` | Preview what a command would do |
| `status` | Show Shell Guardian status |
| `stats` | Show command statistics |
| `suggest` | View rule suggestions from learning |
| `config` | Manage guard configuration |

---

## tollgate guard init

Generate shell integration code for your shell.

```bash
tollgate guard init --shell <shell> [options]
```

### Options

| Option | Description | Default |
|:-------|:------------|:--------|
| `--shell` | Target shell (bash, zsh, fish) | auto-detect |
| `--method` | Hook method (preexec, trap, widget) | auto |
| `--output` | Output file (or stdout) | stdout |

### Examples

```bash
# Generate for bash and append to bashrc
tollgate guard init --shell bash >> ~/.bashrc

# Generate for zsh
tollgate guard init --shell zsh >> ~/.zshrc

# Generate for fish
tollgate guard init --shell fish >> ~/.config/fish/config.fish

# Preview without installing
tollgate guard init --shell bash
```

---

## tollgate guard check

Evaluate a command against policies. This is called by shell hooks.

```bash
tollgate guard check "<command>" [options]
```

### Options

| Option | Description | Default |
|:-------|:------------|:--------|
| `--cwd` | Working directory | current |
| `--dry-run` | Analyze without prompting | false |
| `--json` | Output JSON result | false |
| `--timeout` | Approval timeout (ms) | 60000 |

### Exit Codes

| Code | Meaning |
|:-----|:--------|
| 0 | Command allowed |
| 1 | Command denied |
| 2 | Timeout |
| 3 | Error |

### Examples

```bash
# Check a command
tollgate guard check "rm -rf node_modules"

# Dry run (analysis only)
tollgate guard check "rm -rf /" --dry-run

# JSON output for scripting
tollgate guard check "npm install" --json
```

### JSON Output

```json
{
  "command": "rm -rf node_modules",
  "decision": "prompt",
  "risk": "write",
  "analysis": {
    "triggers": ["recursive deletion"],
    "mitigations": ["regenerable directory"]
  },
  "context": {
    "projectType": "nodejs",
    "gitRepo": true,
    "environment": "development"
  },
  "reversibility": {
    "level": "fully-reversible",
    "score": 100,
    "instructions": "npm install"
  }
}
```

---

## tollgate guard preview

Preview what a command would do without executing it.

```bash
tollgate guard preview "<command>" [options]
```

### Options

| Option | Description | Default |
|:-------|:------------|:--------|
| `--cwd` | Working directory | current |
| `--expand` | Expand globs to show files | true |
| `--max-files` | Maximum files to show | 100 |
| `--json` | Output JSON | false |

### Examples

```bash
# Preview file deletion
tollgate guard preview "rm -rf src/**/*.test.ts"

# Preview with glob expansion
tollgate guard preview "rm *.log" --expand

# JSON output
tollgate guard preview "chmod -R 755 /var/www" --json
```

### Output

```
Command: rm -rf src/**/*.test.ts

What this will do:
  ðŸ—‘ï¸  Delete 47 files
      src/utils/helpers.test.ts
      src/api/routes.test.ts
      src/components/Button.test.ts
      ... and 44 more

  Impact: 2.3 MB across 47 test files

Reversibility:
  âš ï¸  partially-reversible (65%)
  How to undo: git checkout -- src/

Risk Level: destructive
```

---

## tollgate guard status

Show Shell Guardian status and active session grants.

```bash
tollgate guard status [options]
```

### Options

| Option | Description | Default |
|:-------|:------------|:--------|
| `--json` | Output JSON | false |

### Output

```
Shell Guardian Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Status: Active âœ“
  Shell: bash (via preexec)
  Config: ~/.config/tollgate/guard.yaml

  Active session grants: 3
    â€¢ npm run * (tool scope, expires in 4m)
    â€¢ git status (exact scope, expires in 12m)
    â€¢ ls * (session scope, no expiry)

  Fast path: enabled (47 prefixes)
  Learning: enabled (1,247 records)
```

---

## tollgate guard stats

Show command statistics and learning data.

```bash
tollgate guard stats [options]
```

### Options

| Option | Description | Default |
|:-------|:------------|:--------|
| `--learning` | Include learning statistics | false |
| `--days` | Statistics period (days) | 30 |
| `--json` | Output JSON | false |

### Examples

```bash
# Basic statistics
tollgate guard stats

# Include learning data
tollgate guard stats --learning

# Last 7 days
tollgate guard stats --days 7
```

### Output

```
Shell Guardian Statistics (last 30 days)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Commands evaluated: 1,247

  Decisions:
    Allowed (fast path): 892 (72%)
    Allowed (rule):      156 (12%)
    Prompted:            156 (12%)
    Denied:               43 (4%)

  Risk levels encountered:
    safe:        456
    read:        389
    write:       267
    destructive:  98
    dangerous:    37

  Top commands:
    git status    â†’ 234 (always allowed)
    npm run dev   â†’ 178 (always allowed)
    rm -rf *      â†’ 67 (56% approved)
```

---

## tollgate guard suggest

View and manage rule suggestions from the learning system.

```bash
tollgate guard suggest [options]
```

### Options

| Option | Description | Default |
|:-------|:------------|:--------|
| `--export` | Export as YAML | false |
| `--min-confidence` | Minimum confidence | 0.7 |
| `--accept` | Accept suggestion by ID | - |
| `--dismiss` | Dismiss suggestion by ID | - |

### Examples

```bash
# View suggestions
tollgate guard suggest

# Export as YAML
tollgate guard suggest --export > rules.yaml

# Accept a suggestion
tollgate guard suggest --accept abc123

# Dismiss a suggestion
tollgate guard suggest --dismiss def456
```

### Output

```
Rule Suggestions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Found 3 rule suggestions:

  1. [ALLOW] npm run *
     Confidence: 94% | Based on 47 occurrences
     This command pattern was approved 98% of the time.
     [a] Accept  [d] Dismiss

  2. [ALLOW] git status
     Confidence: 97% | Based on 89 occurrences
     This command pattern was approved 100% of the time.
     [a] Accept  [d] Dismiss

  3. [DENY] rm -rf /
     Confidence: 99% | Based on 12 occurrences
     This command pattern was denied 100% of the time.
     [a] Accept  [d] Dismiss
```

---

## tollgate guard config

Manage guard configuration.

```bash
tollgate guard config <subcommand> [options]
```

### Subcommands

| Subcommand | Description |
|:-----------|:------------|
| `show` | Show current configuration |
| `edit` | Open config in editor |
| `reset` | Reset to defaults |
| `validate` | Validate configuration |

### Examples

```bash
# Show configuration
tollgate guard config show

# Edit configuration
tollgate guard config edit

# Validate configuration
tollgate guard config validate

# Reset to defaults
tollgate guard config reset
```

---

## Configuration File

Shell Guardian uses `~/.config/tollgate/guard.yaml`:

```yaml
# Risk level â†’ action mapping
riskActions:
  safe: allow
  read: allow
  write: prompt
  destructive: prompt
  dangerous: deny

# Fast path for performance
fastPath:
  enabled: true
  prefixes:
    - "ls"
    - "cd"
    - "pwd"
    - "git status"
    - "npm list"

# Allowlist (exact matches)
allowlist:
  - "npm run dev"
  - "npm test"

# Denylist (patterns)
denylist:
  - pattern: "rm -rf /"
    reason: "System destruction"
  - pattern: "chmod 777"
    reason: "Insecure permissions"

# Custom rules
rules:
  - pattern: "npm run *"
    action: allow
  - pattern: "docker rm *"
    action: prompt

# Session configuration
session:
  enabled: true
  defaultDuration: "5m"
  defaultScope: "tool"

# Context configuration
context:
  git:
    enabled: true
    uncommittedRiskMultiplier: 1.5
  project:
    enabled: true
  environment:
    enabled: true

# UI configuration
ui:
  showPreview: true
  showAlternatives: true
  showReversibility: true
  timeout: 60000

# Learning configuration
learning:
  enabled: true
  minOccurrences: 5
  minConfidence: 0.7
```

---

## Environment Variables

| Variable | Description | Default |
|:---------|:------------|:--------|
| `TOLLGATE_GUARD_CONFIG` | Config file path | `~/.config/tollgate/guard.yaml` |
| `TOLLGATE_GUARD_ENABLED` | Enable/disable guard | `true` |
| `TOLLGATE_BYPASS` | Bypass for single command | `false` |
| `TOLLGATE_DEBUG` | Enable debug logging | `false` |

## See Also

- [Shell Guardian Overview](/tollgate/concepts/shell-guardian)
- [Shell Integration Guide](/tollgate/guides/shell-integration)
- [Context System](/tollgate/concepts/context-system)
- [Pattern Learning](/tollgate/concepts/learning)
