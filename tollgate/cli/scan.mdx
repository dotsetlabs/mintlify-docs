---
title: 'scan'
description: 'Scan an MCP server to discover tools and assess security risks'
---

# tollgate scan

The `scan` command spawns an MCP server, discovers its available tools, and performs security risk assessment on each tool. It generates recommended security policies based on the analysis.

This is a **proactive security measure** that helps you understand what an MCP server can do before deploying it to production.

## Usage

```bash
tollgate scan <package-or-command> [args...]
```

## Options

| Option | Description |
|:-------|:------------|
| `-o, --output <path>` | Output generated config to file |
| `-g, --generate-config` | Generate recommended configuration |
| `-a, --append` | Append to existing config file |
| `-n, --server-name <name>` | Server name for generated config |
| `-t, --timeout <ms>` | Connection timeout (default: 30000) |
| `-e, --env <key=value...>` | Environment variables to pass to server |
| `--json` | Output results as JSON |

---

## How It Works

1. **Server Spawn**: The scanner spawns the MCP server process
2. **Tool Discovery**: Calls `tools/list` to get all available tool definitions
3. **Risk Analysis**: Analyzes each tool's name, description, and parameters for risk indicators
4. **Policy Generation**: Recommends appropriate actions (allow/prompt/deny/smart) for each tool

---

## Risk Levels

The scanner classifies tools into five risk levels:

| Level | Description | Keywords |
|:------|:------------|:---------|
| üü¢ **safe** | No risk indicators found | - |
| üü¢ **read** | Read-only operations | get, list, fetch, search, view |
| üü° **write** | Write operations | create, add, update, insert, upload |
| üî¥ **destructive** | Potentially destructive | delete, remove, drop, truncate, purge |
| üî¥ **dangerous** | Arbitrary code/command execution | execute, run, eval, shell, command |

---

## Examples

### Basic Scan

```bash
tollgate scan @modelcontextprotocol/server-memory
```

Output:
```
üîç Scanning MCP Server...

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë MCP Server Security Scan: ...server-memory                 ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Tools Found: 9                                             ‚ïë
‚ïë                                                            ‚ïë
‚ïë   üü° create_entities      Create multiple entities...      ‚ïë
‚ïë   üü° create_relations     Create relations between...      ‚ïë
‚ïë   üî¥ delete_entities      Delete entities...               ‚ïë
‚ïë   üü¢ read_graph           Read the knowledge graph         ‚ïë
‚ïë   üü¢ open_nodes           Open specific nodes...           ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Risk Assessment:                                           ‚ïë
‚ïë   üü° create_entities: write operation                      ‚ïë
‚ïë   üî¥ delete_entities: destructive operation                ‚ïë
‚ïë   üü¢ 2 tool(s) are read-only (safe)                        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Recommended Policy:                                        ‚ïë
‚ïë   allow:  2 tool(s) (read-only)                            ‚ïë
‚ïë   prompt: 3 tool(s) (require approval)                     ‚ïë
‚ïë   deny:   3 tool(s) (blocked)                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Overall Risk: DESTRUCTIVE
```

### Generate Configuration

```bash
# Generate and output to stdout
tollgate scan @modelcontextprotocol/server-postgres --generate-config

# Save to file
tollgate scan @modelcontextprotocol/server-postgres -g -o tollgate.yaml

# Append to existing config
tollgate scan @anthropic/mcp-server-fetch -g -o tollgate.yaml --append
```

### Scan with Environment Variables

```bash
# Pass required environment variables
tollgate scan @modelcontextprotocol/server-postgres \
  -e DATABASE_URL=postgresql://localhost/mydb
```

### JSON Output for Scripting

```bash
tollgate scan @modelcontextprotocol/server-memory --json | jq '.summary'
```

```json
{
  "safe": 0,
  "read": 2,
  "write": 4,
  "destructive": 3,
  "dangerous": 0
}
```

---

## Generated Policy Example

When using `--generate-config`, the scanner produces a complete `tollgate.yaml`:

```yaml
# Tollgate Configuration
# Generated by `tollgate scan`
# Review and customize before use

version: "1"

defaults:
  action: prompt
  timeout: 60000

servers:
  memory:
    command: "npx"
    args: ["-y", "@modelcontextprotocol/server-memory"]

    tools:
      # Read-only operations (safe)
      "read_graph":
        action: allow
      "open_nodes":
        action: allow

      # Write operations (require approval)
      "create_entities":
        action: prompt
        message: "Agent wants to run create_entities"
      "create_relations":
        action: prompt

      # Dangerous operations (blocked)
      "delete_entities":
        action: deny
        reason: "Destructive operation blocked"
      "delete_relations":
        action: deny

      # Catch-all for unknown tools
      "*":
        action: prompt
```

---

## Smart Analyzer Detection

The scanner automatically detects when smart analyzers can be used:

| Tool Pattern | Recommended Analyzer |
|:-------------|:---------------------|
| SQL, query, database | `sql` analyzer |
| file, path, directory | `filesystem` analyzer |
| shell, command, exec | `shell` analyzer |
| http, fetch, url | `http` analyzer |

When a smart analyzer is detected, the recommended action becomes `smart` instead of `prompt`, allowing for intelligent content-based decisions.

---

## Use Cases

### Pre-Deployment Security Audit

Before adding a new MCP server to your configuration:

```bash
tollgate scan @new-mcp-server --json > audit.json
```

### Generate Starter Configuration

Bootstrap a new project with recommended policies:

```bash
tollgate scan @modelcontextprotocol/server-postgres -g -o tollgate.yaml
tollgate scan @anthropic/mcp-server-filesystem -g -o tollgate.yaml -a
```

### CI/CD Security Gate

Add to your pipeline to ensure servers meet security requirements:

```bash
#!/bin/bash
result=$(tollgate scan $MCP_PACKAGE --json)
dangerous=$(echo $result | jq '.summary.dangerous')
if [ "$dangerous" -gt 0 ]; then
  echo "‚ùå Server has dangerous tools"
  exit 1
fi
```

---

## Best Practices

1. **Always scan before deploying** - Run scan on new MCP servers before adding to production
2. **Review generated configs** - The scanner provides recommendations; always review before use
3. **Update periodically** - Re-scan servers after updates to catch new tools
4. **Use JSON output for automation** - The JSON format is stable for scripting
