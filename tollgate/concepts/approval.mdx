---
title: Approval Methods
description: 'Terminal prompts or web-based approval UI'
---

# Approval Methods

When a policy requires user approval, Tollgate supports multiple ways to present the approval request.

## Terminal (Default)

The terminal approval method prompts directly in your terminal. Best for local development when you're actively watching the output.

```bash
tollgate start -s postgres
# or
tollgate wrap npx mcp-server-postgres
```

When an approval is needed:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  TOLLGATE: Agent requesting action
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Server:  postgres
  Tool:    query
  Risk:    write

  INSERT INTO users (name) VALUES ('Alice')

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Allow? [y]es once / [5]min / [15]min / [s]ession / [N]o
```

### Terminal Shortcuts

| Key | Action |
|-----|--------|
| `y` | Approve once (no session grant) |
| `5` | Approve and grant for 5 minutes |
| `15` | Approve and grant for 15 minutes |
| `30` | Approve and grant for 30 minutes |
| `s` | Approve for entire session |
| `n` or Enter | Deny |

### Advanced Syntax

Specify scope with duration:

```
> tool:15min    # Grant for this tool for 15 minutes
> server:5min   # Grant for all tools on this server for 5 minutes
> exact:session # Grant for this exact tool+args for session
```

## Interactive (Web UI)

The interactive approval method serves a web UI where you can review and approve requests from your browser. Useful when:

- You're not actively watching the terminal
- You want a more visual approval experience
- You're running Tollgate in the background

### Starting with Interactive Mode

```bash
# Use the web UI for approvals
tollgate start -s postgres --approval interactive

# Custom port
tollgate start -s postgres --approval interactive --approval-port 3000
```

### Using the Web UI

1. Open `http://localhost:9847` in your browser
2. Pending approvals appear in real-time
3. Review the request details (server, tool, arguments, risk level)
4. Click an approval button:
   - **Deny** - Reject the request
   - **Allow Once** - Approve without session grant
   - **Allow 5 min** - Approve with 5-minute session grant
   - **Allow 15 min** - Approve with 15-minute session grant
   - **Allow Session** - Approve for entire session

### Web UI Features

- **Real-time updates** via Server-Sent Events
- **Risk-level coloring** (safe=green, read=blue, write=yellow, destructive/dangerous=red)
- **Countdown timer** showing time until auto-deny
- **Full argument display** for reviewing exactly what the agent wants to do

## Webhook

The webhook approval method sends approval requests to an external HTTP endpoint. Ideal for:

- Automated approval workflows
- Integration with ticketing systems (Slack, PagerDuty, etc.)
- Custom approval UIs
- Multi-team approval policies

### Starting with Webhook Mode

```bash
# Use webhook for approvals
tollgate start -s postgres --approval webhook

# Requires webhookUrl in config
```

### Configuration

```yaml
approval:
  method: webhook
  timeout: 60000
  webhookUrl: https://your-server.com/approve
  webhookHeaders:
    Authorization: Bearer ${APPROVAL_TOKEN}
  webhookSecret: ${WEBHOOK_SECRET}  # For HMAC signing
```

### Request Format

Tollgate sends a POST request to your webhook URL:

```json
{
  "id": "req_abc123",
  "server": "postgres",
  "tool": "query",
  "arguments": {
    "query": "INSERT INTO users (name) VALUES ('Alice')"
  },
  "risk": "write",
  "timestamp": "2025-01-04T10:30:00Z"
}
```

### Response Format

Your webhook should respond with:

```json
{
  "approved": true,
  "duration": "5min"
}
```

| Field | Type | Description |
| ----- | ---- | ----------- |
| `approved` | boolean | Whether to allow the request |
| `duration` | string | Optional session grant duration: `once`, `5min`, `15min`, `30min`, `session` |

### HMAC Signature

If `webhookSecret` is configured, Tollgate signs the request body with HMAC-SHA256:

```
X-Tollgate-Signature: sha256=<hex-encoded-signature>
```

Verify the signature server-side:

```javascript
const crypto = require('crypto');

function verifySignature(body, signature, secret) {
  const expected = 'sha256=' + crypto
    .createHmac('sha256', secret)
    .update(body)
    .digest('hex');
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expected)
  );
}
```

### Error Handling

| Response | Behavior |
| -------- | -------- |
| 2xx with `approved: true` | Request allowed |
| 2xx with `approved: false` | Request denied |
| 4xx/5xx | Request denied with error logged |
| Timeout | Request denied (default: 60s) |

## Configuration

Set the approval method in `tollgate.yaml`:

```yaml
approval:
  method: interactive  # 'terminal', 'interactive', or 'webhook'
  port: 9847          # for interactive mode
  timeout: 60000      # approval timeout in ms

  # Webhook-specific settings
  webhookUrl: https://your-server.com/approve
  webhookHeaders:
    Authorization: Bearer ${TOKEN}
  webhookSecret: ${SECRET}
```

## Comparison

| Feature | Terminal | Interactive | Webhook |
|---------|----------|-------------|---------|
| Requires terminal focus | Yes | No | No |
| Browser required | No | Yes | No |
| Keyboard shortcuts | Yes | No | No |
| Visual risk indicators | Color-coded text | Color-coded badges | N/A |
| Multiple pending requests | One at a time | Queue visible | Parallel |
| Best for | Active development | Background operation | Automation |
| Custom integration | No | No | Yes |

## Timeout Behavior

Both methods have a configurable timeout (default: 60 seconds). If no response is received within the timeout, the request is automatically denied.

```bash
# Set 2-minute timeout
tollgate start -s postgres --timeout 120000
```
