---
title: Safer Alternatives
description: 'Automatic suggestions for safer command alternatives'
---

# Safer Alternatives

When Shell Guardian prompts you to approve a risky command, it suggests safer alternatives. These alternatives accomplish the same goal with less risk or better reversibility.

## How Alternatives Work

The alternatives engine:
1. Parses the command to understand intent
2. Looks up safer patterns from the registry
3. Filters by availability (checks if tools exist)
4. Scores by safety improvement
5. Presents up to 5 options

## Example

```
⚠  Command Review Required
────────────────────────────────────────────────────────

  Command:
    rm -rf node_modules

  Safer alternatives:
    [1] git clean -fd (reversible via git)
        70% safer • Requires: git
    [2] mv node_modules /tmp/node_modules_$(date +%s)
        85% safer • Creates backup
    [3] trash node_modules
        90% safer • Requires: trash-cli

────────────────────────────────────────────────────────

  [y] Allow   [n] Deny   [1-3] Alternative   [r] Remember

  > 2
  ✓ Using alternative: mv node_modules /tmp/node_modules_1699574832
```

## Built-in Alternative Mappings

### File Deletion

| Risky Command | Safer Alternative | Why Safer |
|:--------------|:------------------|:----------|
| `rm -rf <dir>` | `trash <dir>` | Recoverable from trash |
| `rm -rf <dir>` | `mv <dir> /tmp/backup_<timestamp>` | Creates backup |
| `rm -rf <dir>` | `git clean -fd` | Only removes untracked files |
| `rm <file>` | `trash <file>` | Recoverable |

### Permission Changes

| Risky Command | Safer Alternative | Why Safer |
|:--------------|:------------------|:----------|
| `chmod 777 <path>` | `chmod 755 <path>` | No world-write |
| `chmod 777 <path>` | `chmod u+x <path>` | Minimal change |
| `chown root <path>` | `sudo chown $USER <path>` | Keeps user ownership |

### Git Operations

| Risky Command | Safer Alternative | Why Safer |
|:--------------|:------------------|:----------|
| `git reset --hard` | `git stash` | Preserves changes |
| `git push --force` | `git push --force-with-lease` | Checks for conflicts |
| `git clean -fd` | `git clean -fdn` (dry run first) | Preview before delete |

### Remote Execution

| Risky Command | Safer Alternative | Why Safer |
|:--------------|:------------------|:----------|
| `curl url \| bash` | `curl -o script.sh url && cat script.sh && bash script.sh` | Review before execute |
| `wget url \| sh` | `wget -O script.sh url && less script.sh && sh script.sh` | Review before execute |

### Process Operations

| Risky Command | Safer Alternative | Why Safer |
|:--------------|:------------------|:----------|
| `kill -9 <pid>` | `kill -15 <pid>` | Graceful shutdown |
| `killall <name>` | `pkill -15 <name>` | Signal-based, graceful |

## Alternative Properties

Each alternative includes:

```typescript
interface SaferAlternative {
  command: string;      // The safer command
  reason: string;       // Why it's safer
  safetyImprovement: number;  // 0-100% reduction in risk
  reversible: boolean;  // Can the action be undone?
  requiresTool?: string;  // Tool that must be installed
}
```

## Tool Availability Checking

Shell Guardian checks if required tools exist before suggesting:

```bash
# If 'trash-cli' is installed
rm -rf build/
  [1] trash build/  ← Shown

# If 'trash-cli' is NOT installed
rm -rf build/
  [1] mv build/ /tmp/build_backup  ← Shown instead
  Note: Install 'trash-cli' for better alternatives
```

## Context-Aware Alternatives

Alternatives adapt to your environment:

### In a Git Repository

```
rm -rf src/
  [1] git stash -u && rm -rf src/  # Stash first
  [2] git clean -fd  # Remove untracked only
```

### In a Node.js Project

```
rm -rf node_modules
  [1] npm ci  # Clean reinstall
  [2] npm prune  # Remove extraneous packages
```

### With Uncommitted Changes

```
git reset --hard
  [1] git stash  # Save changes first
  [2] git stash && git reset --hard  # Combined
```

## Selecting Alternatives

### Quick Selection

Press the number key to instantly use an alternative:

```
[1-5] Alternative

> 1
✓ Using alternative: trash build/
```

### Alternative Execution

When you select an alternative:
1. The original command is NOT executed
2. The alternative command runs instead
3. The decision is logged for learning

## Custom Alternative Mappings

Add your own alternatives in config:

```yaml
alternatives:
  mappings:
    # Pattern → alternatives
    "docker rm -f *":
      - command: "docker stop $1 && docker rm $1"
        reason: "Graceful stop before removal"
        safetyImprovement: 60
        reversible: false

    "npm install *":
      - command: "npm install --save-exact $1"
        reason: "Pin exact version"
        safetyImprovement: 30
        reversible: true

    "apt-get remove *":
      - command: "apt-get remove --dry-run $1"
        reason: "Preview removal first"
        safetyImprovement: 80
        reversible: true
```

## Minimum Safety Threshold

Only show alternatives that provide meaningful improvement:

```yaml
alternatives:
  # Only show alternatives with >=30% safety improvement
  minSafetyImprovement: 30

  # Maximum alternatives to display
  maxAlternatives: 5

  # Check tool availability before suggesting
  checkToolAvailability: true
```

## Reversibility Indicators

Alternatives show reversibility status:

```
[1] git stash
    70% safer • ↩️ reversible

[2] rm -rf build/
    0% safer • ⚠ not reversible
```

Icons:
- `↩️` - Reversible (can be undone)
- `⚠` - Not reversible (permanent)

## Learning from Alternative Choices

When you consistently choose alternatives, Shell Guardian learns:

```
Pattern detected: You chose 'trash' over 'rm' 15 times

Suggestion:
  Create rule: Replace 'rm' with 'trash' automatically
  Confidence: 87%

  [a] Accept  [d] Dismiss
```

## Disabling Alternatives

```yaml
alternatives:
  # Disable alternative suggestions
  enabled: false

  # Or disable for specific commands
  excludePatterns:
    - "git *"
    - "npm *"
```

## Next Steps

- [Shell Guardian Overview](/tollgate/concepts/shell-guardian) - Main documentation
- [Preview](/tollgate/concepts/preview) - See what commands will do
- [Reversibility](/tollgate/concepts/reversibility) - Understand recovery options
- [Learning](/tollgate/concepts/learning) - How alternative choices affect suggestions
