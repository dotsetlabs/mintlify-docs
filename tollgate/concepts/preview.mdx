---
title: Command Preview
description: 'Visualize what commands will do before execution'
---

# Command Preview

Shell Guardian can show you exactly what a command will do before you approve it. This preview expands globs, counts files, and estimates impact.

## Preview Display

```
âš   Command Review Required
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Command:
    rm -rf src/**/*.test.ts

  What this will do:
    ğŸ—‘ï¸  Delete 47 files
        src/utils/helpers.test.ts
        src/api/routes.test.ts
        src/components/Button.test.ts
        ... and 44 more

    Impact: 2.3 MB across 47 test files
```

## Effect Types

Shell Guardian categorizes command effects:

| Effect | Icon | Description |
|:-------|:-----|:------------|
| `delete` | ğŸ—‘ï¸ | Removes files or directories |
| `modify` | âœï¸ | Changes file contents |
| `create` | ğŸ“„ | Creates new files |
| `read` | ğŸ‘ï¸ | Reads file contents |
| `execute` | âš¡ | Runs executables |
| `network` | ğŸŒ | Network operations |
| `permission` | ğŸ”’ | Changes permissions |
| `process` | âš™ï¸ | Process management |

## Preview Examples

### File Deletion

```
Command: rm -rf node_modules

What this will do:
  ğŸ—‘ï¸  Delete 1,247 files
      node_modules/express/index.js
      node_modules/lodash/lodash.js
      node_modules/react/index.js
      ... and 1,244 more

  Impact: 127 MB across 89 packages
```

### Glob Expansion

```
Command: rm src/**/*.log

What this will do:
  ğŸ—‘ï¸  Delete 12 files
      src/app.log
      src/api/requests.log
      src/worker/jobs.log
      ... and 9 more

  Impact: 45 KB across 12 log files
```

### Mixed Operations

```
Command: find . -name "*.bak" -delete

What this will do:
  ğŸ—‘ï¸  Delete 23 files
      ./config.bak
      ./src/index.bak
      ./test/setup.bak
      ... and 20 more

  Impact: 156 KB across 23 backup files
```

### Permission Changes

```
Command: chmod -R 755 /var/www

What this will do:
  ğŸ”’ Change permissions on 234 files
      /var/www/index.html
      /var/www/css/style.css
      /var/www/js/app.js
      ... and 231 more

  Impact: 234 files will become rwxr-xr-x
```

## Impact Assessment

Each preview includes an impact summary:

```typescript
interface ImpactAssessment {
  fileCount: number;      // Total files affected
  totalBytes: number;     // Total data size
  summary: string;        // Human-readable summary
  byType: Record<string, number>;  // Files by extension
}
```

### Impact Examples

```
Impact: 2.3 MB across 47 files
Impact: 127 MB across 1,247 files (89 packages)
Impact: 45 KB across 12 log files
Impact: 234 files will be modified
```

## Dangerous Pattern Detection

Shell Guardian flags dangerous patterns in previews:

### Sudo + Recursive Delete

```
Command: sudo rm -rf /var/log

âš ï¸  DANGEROUS PATTERN DETECTED
    Elevated privileges + recursive deletion

What this will do:
  ğŸ—‘ï¸  Delete system logs (requires root)
      /var/log/syslog
      /var/log/auth.log
      ... and more

  Impact: System logs will be permanently deleted
```

### Large Operations

```
Command: rm -rf ~/Downloads

âš ï¸  LARGE OPERATION
    This will affect >1000 files (15 GB)

What this will do:
  ğŸ—‘ï¸  Delete 3,456 files
      ~/Downloads/document.pdf
      ~/Downloads/image.png
      ... and 3,454 more

  Impact: 15.2 GB across 3,456 files
```

### Force Flag

```
Command: rm -rf --no-preserve-root /

âš ï¸  FORCE FLAG DETECTED
    --no-preserve-root bypasses safety checks

What this will do:
  ğŸ—‘ï¸  Delete ENTIRE FILESYSTEM
      This is a destructive operation with no recovery
```

## Confidence Levels

Previews include confidence in predictions:

| Level | Meaning |
|:------|:--------|
| `certain` | Static analysis, exact files known |
| `probable` | Glob expansion, files likely exist |
| `possible` | Dynamic command, effects uncertain |

```
What this will do:
  ğŸ—‘ï¸  Delete 47 files (certain)
      Files verified to exist

  ğŸ—‘ï¸  May delete additional files (possible)
      Command uses dynamic patterns
```

## Expansion Limits

For performance, Shell Guardian limits expansion:

```yaml
preview:
  # Maximum files to expand
  maxExpansion: 1000

  # Timeout for glob expansion
  expansionTimeoutMs: 5000

  # Show file details up to this count
  showDetailsUpTo: 10
```

When limits are exceeded:

```
What this will do:
  ğŸ—‘ï¸  Delete 5,432 files
      node_modules/express/...
      node_modules/lodash/...
      node_modules/react/...
      ... and 5,429 more (expansion limited)

  âš ï¸  Full expansion timed out after 5s
      Actual file count may differ
```

## File Type Breakdown

Previews show file types affected:

```
What this will do:
  ğŸ—‘ï¸  Delete 156 files
      By type:
        .ts  â†’ 89 files
        .js  â†’ 45 files
        .json â†’ 12 files
        .md  â†’ 10 files

  Impact: 2.1 MB across 4 file types
```

## Command Parsing

Shell Guardian parses commands to understand structure:

```typescript
interface ParsedCommand {
  executable: string;    // "rm"
  subcommand?: string;   // undefined
  flags: string[];       // ["-r", "-f"]
  arguments: string[];   // ["node_modules"]
  hasSudo: boolean;      // false
  isRecursive: boolean;  // true
  hasForce: boolean;     // true
}
```

### Recognized Flags

| Flag | Detection |
|:-----|:----------|
| `-r`, `-R`, `--recursive` | Recursive operation |
| `-f`, `--force` | Force (no prompts) |
| `--no-preserve-root` | Root safety bypass |
| `-n`, `--dry-run` | Preview only |

## Disabling Preview

```yaml
preview:
  # Disable preview entirely
  enabled: false

  # Or disable for specific commands
  excludePatterns:
    - "git *"  # Git has its own preview
    - "docker *"  # Complex to preview
```

## Preview-Only Mode

Run commands in preview mode without execution:

```bash
# Preview what would happen
tollgate guard preview "rm -rf node_modules"

# Output:
What this command would do:
  ğŸ—‘ï¸  Delete 1,247 files (127 MB)
  Reversibility: fully-reversible (npm install)
  Risk level: write
```

## Configuration

```yaml
preview:
  enabled: true

  # Expansion settings
  maxExpansion: 1000
  expansionTimeoutMs: 5000
  showDetailsUpTo: 10

  # Warning thresholds
  largeOperationThreshold: 1000  # files
  largeSizeThreshold: 1073741824  # 1 GB

  # Include file type breakdown
  showFileTypes: true

  # Show size estimates
  showSizeEstimates: true
```

## Next Steps

- [Shell Guardian Overview](/tollgate/concepts/shell-guardian) - Main documentation
- [Reversibility](/tollgate/concepts/reversibility) - Can you undo the previewed action?
- [Alternatives](/tollgate/concepts/alternatives) - Safer ways to achieve the same goal
