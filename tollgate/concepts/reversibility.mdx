---
title: Reversibility Analysis
description: 'Understanding if commands can be undone'
---

# Reversibility Analysis

Shell Guardian analyzes whether commands can be reversed and provides recovery instructions. This helps you understand the true risk of an action.

## Reversibility Levels

| Level | Icon | Score | Description |
|:------|:-----|:------|:------------|
| `fully-reversible` | ‚Ü©Ô∏è | 80-100% | Can be completely undone |
| `partially-reversible` | ‚ö†Ô∏è | 40-79% | Some effects can be undone |
| `difficult-to-reverse` | üî∂ | 10-39% | Requires significant effort |
| `irreversible` | ‚õî | 0-9% | Cannot be undone |

## Reversibility Display

```
‚ö†  Command Review Required
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  Command:
    rm -rf src/components

  Reversibility:
    ‚ö†Ô∏è  partially-reversible (65%)

    ‚Ü©Ô∏è  Recoverable (23 files):
        src/components/Button.tsx (git tracked)
        src/components/Modal.tsx (git tracked)
        ... and 21 more

    ‚õî Not recoverable (12 files):
        src/components/NewFeature.tsx (untracked)
        src/components/Draft.tsx (untracked)
        ... and 10 more

    How to undo: git checkout -- src/components/

    ‚ö† Potential loss: 12 untracked files will be permanently deleted
```

## Reversibility Factors

Shell Guardian considers multiple factors when calculating reversibility:

### Git Tracking

Files tracked by git can be recovered:

```
Factor: Git tracking
  ‚úì 45 files tracked ‚Üí recoverable via git checkout
  ‚úó 12 files untracked ‚Üí not recoverable
  Score contribution: +60%
```

### Regenerable Directories

Package manager directories can be regenerated:

```
Factor: Regenerable directory
  node_modules ‚Üí npm install
  __pycache__ ‚Üí automatic on next run
  target/ ‚Üí cargo build
  Score contribution: +100%
```

### Backup Existence

Shell Guardian checks for backups:

```
Factor: Backup available
  ‚úì File exists in Time Machine
  ‚úì File exists in ~/.trash
  Score contribution: +40%
```

### Operation Type

Some operations are inherently more reversible:

| Operation | Base Reversibility |
|:----------|:-------------------|
| Read | 100% (no change) |
| Create | 90% (just delete) |
| Modify | 60% (depends on backup) |
| Delete | Variable (depends on recovery) |
| Permission | 80% (if original known) |

## Recovery Instructions

Shell Guardian provides specific recovery steps:

### Git Recovery

```
How to undo:
  git checkout -- src/components/
  git restore src/components/
```

### Package Manager Recovery

```
How to undo:
  npm install
  pip install -r requirements.txt
  cargo build
```

### Trash Recovery

```
How to undo:
  trash-restore
  Open Trash and restore files
```

### Manual Recovery

```
How to undo:
  Restore from backup at ~/backups/
  Contact system administrator
```

## Examples by Command

### Fully Reversible

```
Command: rm -rf node_modules

Reversibility:
  ‚Ü©Ô∏è  fully-reversible (100%)
  How to undo: npm install
```

```
Command: git reset --soft HEAD~1

Reversibility:
  ‚Ü©Ô∏è  fully-reversible (95%)
  How to undo: git reflog + git reset
```

### Partially Reversible

```
Command: rm -rf src/

Reversibility:
  ‚ö†Ô∏è  partially-reversible (65%)

  Recoverable:
    45 files via git checkout

  Not recoverable:
    12 untracked files

  How to undo: git checkout -- src/
  Potential loss: 12 files permanently deleted
```

### Difficult to Reverse

```
Command: chmod -R 777 /var/www

Reversibility:
  üî∂ difficult-to-reverse (25%)

  Challenge:
    Original permissions not recorded
    Must manually restore each file

  How to undo: Restore from backup or manually set permissions
```

### Irreversible

```
Command: shred -vfz secret.key

Reversibility:
  ‚õî irreversible (0%)

  Reason:
    shred overwrites data multiple times
    File cannot be recovered even with forensics

  Potential loss: secret.key permanently destroyed
```

## Score Calculation

Reversibility score is calculated from weighted factors:

```
Score = Œ£ (factor_score √ó factor_weight)

Factors:
  - Git tracking: weight 0.4
  - Regenerable: weight 0.3
  - Backup exists: weight 0.2
  - Operation type: weight 0.1
```

### Example Calculation

```
Command: rm -rf src/components

Factors:
  Git tracking: 65% of files tracked ‚Üí 0.65 √ó 0.4 = 0.26
  Regenerable: Not regenerable ‚Üí 0.0 √ó 0.3 = 0.00
  Backup: No backup detected ‚Üí 0.0 √ó 0.2 = 0.00
  Operation: Delete ‚Üí 0.3 √ó 0.1 = 0.03

Total: 0.29 ‚Üí 29% ‚Üí difficult-to-reverse
```

## Warning Thresholds

Shell Guardian warns for low reversibility:

```yaml
reversibility:
  # Warn if reversibility below this threshold
  warningThreshold: 50

  # Require explicit confirmation for irreversible
  requireConfirmationBelow: 20

  # Block commands below this (unless --force)
  blockBelow: 0
```

### Warning Display

```
‚ö†Ô∏è  LOW REVERSIBILITY WARNING

This command has only 25% reversibility.
If something goes wrong, recovery will be difficult.

Are you sure you want to proceed?
```

## Reversibility in Decision Making

Reversibility affects the approval UI:

### High Reversibility

```
[y] Allow   [n] Deny   [r] Remember
```

### Low Reversibility

```
‚ö†Ô∏è  This action is difficult to reverse

[y] Allow (type 'yes' to confirm)   [n] Deny
```

### Irreversible

```
‚õî This action is IRREVERSIBLE

Type 'I understand this cannot be undone' to proceed:
>
```

## Configuration

```yaml
reversibility:
  enabled: true

  # Analysis options
  checkGitTracking: true
  checkRegenerablePaths: true
  checkBackups: true

  # Warning thresholds
  warningThreshold: 50
  requireConfirmationBelow: 20

  # Custom regenerable paths
  regenerablePaths:
    - "node_modules"
    - "vendor"
    - "build"
    - "dist"
    - ".cache"

  # Recovery command templates
  recoveryCommands:
    git: "git checkout -- {path}"
    npm: "npm install"
    pip: "pip install -r requirements.txt"
    cargo: "cargo build"
```

## Reversibility Icons

| Icon | Meaning | Action |
|:-----|:--------|:-------|
| ‚Ü©Ô∏è | Fully reversible | Proceed with confidence |
| ‚ö†Ô∏è | Partially reversible | Review what's not recoverable |
| üî∂ | Difficult to reverse | Consider alternatives |
| ‚õî | Irreversible | Proceed only if certain |

## Next Steps

- [Shell Guardian Overview](/tollgate/concepts/shell-guardian) - Main documentation
- [Preview](/tollgate/concepts/preview) - See what commands will do
- [Alternatives](/tollgate/concepts/alternatives) - Find reversible alternatives
- [Context System](/tollgate/concepts/context-system) - How context affects reversibility
