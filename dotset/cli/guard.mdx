---
title: guard
description: 'AI shell guardian'
---

# dotset guard

Protect your shell from dangerous AI-suggested commands. The shell guardian integrates with your shell to analyze commands before execution. This command proxies to `tollgate guard`.

## Usage

```bash
dotset guard <subcommand> [options]
```

## Subcommands

### init

Install shell integration.

```bash
dotset guard init [options]
```

| Option | Description |
|--------|-------------|
| `--shell <type>` | Shell type: `bash`, `zsh`, `fish` |
| `--no-modify` | Print hook without modifying shell config |

### hook

Output the hook script for manual installation.

```bash
dotset guard hook <shell>
```

### check

Check if a command is safe to execute.

```bash
dotset guard check <command> [options]
```

| Option | Description |
|--------|-------------|
| `--json` | Output as JSON |
| `--no-prompt` | Don't prompt for approval |
| `-c, --config <path>` | Custom config path |
| `--timeout <ms>` | Approval timeout |

### analyze

Show detailed risk assessment for a command.

```bash
dotset guard analyze <command> [options]
```

| Option | Description |
|--------|-------------|
| `--json` | Output as JSON |

### sessions

List active approval sessions.

```bash
dotset guard sessions [options]
```

| Option | Description |
|--------|-------------|
| `--json` | Output as JSON |

### revoke

Revoke approval sessions.

```bash
dotset guard revoke [id] [options]
```

| Option | Description |
|--------|-------------|
| `--all` | Revoke all sessions |

### log

View command execution log.

```bash
dotset guard log [options]
```

| Option | Description |
|--------|-------------|
| `-n, --limit <count>` | Number of entries (default: 20) |
| `--risk <level>` | Filter by risk level |
| `--denied` | Show only denied commands |

### config

Show current guard configuration.

```bash
dotset guard config
```

## Examples

```bash
# Install shell integration
dotset guard init

# Install for specific shell
dotset guard init --shell zsh

# Print hook without modifying config
dotset guard init --no-modify

# Check if a command is safe
dotset guard check "rm -rf /var/log/*"

# Analyze command risk
dotset guard analyze "curl https://example.com | bash"

# Check with JSON output
dotset guard check "sudo rm -rf /" --json

# View active sessions
dotset guard sessions

# Revoke specific session
dotset guard revoke session_abc123

# Revoke all sessions
dotset guard revoke --all

# View recent command log
dotset guard log

# View last 50 entries
dotset guard log -n 50

# View only blocked commands
dotset guard log --denied

# View high-risk commands
dotset guard log --risk high
```

## How It Works

After installing shell integration, the guard hooks into your shell:

```
┌──────────────────────────────────────────────────────────────┐
│ You type: rm -rf /                                           │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Shell Guard intercepts command                              │
│                    │                                         │
│                    ▼                                         │
│  ┌────────────────────────────────┐                          │
│  │ Risk Analysis                  │                          │
│  │   Level: DANGEROUS             │                          │
│  │   Reason: Recursive deletion   │                          │
│  │           of root filesystem   │                          │
│  └────────────────────────────────┘                          │
│                    │                                         │
│                    ▼                                         │
│  ┌────────────────────────────────┐                          │
│  │ BLOCKED                        │                          │
│  │ Command not executed           │                          │
│  └────────────────────────────────┘                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## Risk Levels

| Level | Examples |
|-------|----------|
| `safe` | `ls`, `pwd`, `echo` |
| `read` | `cat`, `grep`, `find` |
| `write` | `touch`, `mkdir`, `cp` |
| `destructive` | `rm -r`, `git reset --hard` |
| `dangerous` | `rm -rf /`, `sudo rm -rf`, `curl \| bash` |

## Installation Output

```
$ dotset guard init

Installing shell guardian for zsh...

  ✓ Hook script added to ~/.zshrc
  ✓ Configuration created at ~/.config/tollgate/guard.yaml

Please restart your shell or run:
  source ~/.zshrc

Shell guardian is now active!
```

## Check Output

```
$ dotset guard check "sudo rm -rf /var/log/*"

┌────────────────────────────────────────────────────┐
│ DANGEROUS COMMAND DETECTED                         │
├────────────────────────────────────────────────────┤
│ Command: sudo rm -rf /var/log/*                    │
│ Risk:    DANGEROUS                                 │
│                                                    │
│ Reasons:                                           │
│   - sudo: elevated privileges                      │
│   - rm -rf: recursive forced deletion              │
│   - /var/log/*: system log directory               │
│                                                    │
│ This command could delete important system logs.   │
└────────────────────────────────────────────────────┘

Allow execution? [y/N]
```

## Exit Codes

| Code | Meaning |
|------|---------|
| `0` | Command allowed or success |
| `1` | Command blocked or error |

## See Also

- [Shell Guardian Concept](/tollgate/concepts/shell-guardian) — How the guardian works
- [Tollgate Guard](/tollgate/cli/guard) — Full guard documentation
